# .env.example — commit this file; NEVER commit .env (it may contain secrets)
# Copy to .env and fill in your values before running the server.

# ── Transport ──────────────────────────────────────────────────────────────────
MCP_TRANSPORT=stdio            # stdio | sse
MCP_HOST=127.0.0.1             # SSE only — bind address
MCP_PORT=8000                  # SSE only — listen port

# ── LanceDB ────────────────────────────────────────────────────────────────────
# Set this to match your deployment mode:
#   Local dev:      ~/.mcpvectordb/lancedb
#   k3s PVC:        /data/lancedb
#   Remote/S3:      s3://bucket/path  (LanceDB supports s3:// URIs)
LANCEDB_URI=~/.mcpvectordb/lancedb
LANCEDB_TABLE_NAME=documents
DEFAULT_LIBRARY=default            # fallback library name when not specified in tool call

# ── Embedding ──────────────────────────────────────────────────────────────────
# WARNING: changing EMBEDDING_MODEL requires a full re-index — vectors from different
# models are incompatible and search will silently return garbage.
EMBEDDING_MODEL=nomic-ai/nomic-embed-text-v1.5
EMBEDDING_BATCH_SIZE=8          # 8 is safe for 8 GB RAM; raise to 32 only on 16 GB+

# ── Search ─────────────────────────────────────────────────────────────────────
HYBRID_SEARCH_ENABLED=true   # Combine BM25 + vector search; disable for pure-vector mode
SEARCH_REFINE_FACTOR=10      # Re-score top N*refine_factor ANN candidates for better recall

# ── Chunking ───────────────────────────────────────────────────────────────────
CHUNK_SIZE_TOKENS=512
CHUNK_OVERLAP_TOKENS=64
CHUNK_MIN_TOKENS=50

# ── Upload ─────────────────────────────────────────────────────────────────────
MAX_UPLOAD_BYTES=52428800          # 50 MB — maximum size for POST /upload multipart files

# ── Security ───────────────────────────────────────────────────────────────────
# Extra allowed Host headers for DNS rebinding protection (streamable-http only).
# The Host header Claude Desktop sends must appear in this list; otherwise the
# server rejects the request with 421 Misdirected Request.
#
# Direct LAN HTTP (Claude Desktop on same LAN, no HTTPS):
# ALLOWED_HOSTS=10.0.1.4:*
#
# tailscale serve HTTPS (recommended — Claude Desktop requires HTTPS):
#   1. Get your hostname:  tailscale status --json | python3 -c "import json,sys; d=json.load(sys.stdin); print(d['Self']['DNSName'].rstrip('.'))"
#   2. Start HTTPS proxy:  tailscale serve --bg https / http://127.0.0.1:8000
#   3. Set this value to your Tailscale FQDN (no port needed — standard HTTPS port):
# ALLOWED_HOSTS=myhostname.tailXXXXXX.ts.net
#
# Both LAN and Tailscale (comma-separated):
# ALLOWED_HOSTS=10.0.1.4:*,myhostname.tailXXXXXX.ts.net

# ── TLS (streamable-http transport only) ───────────────────────────────────────
# Leave TLS_ENABLED=false (default) when using Tailscale or nginx for HTTPS.
# Both cert and key must be set when TLS_ENABLED=true; missing either fails startup.
#
# Quick self-signed cert (test/dev only):
#   mkdir -p certs && openssl req -x509 -nodes -newkey rsa:2048 \
#     -keyout certs/key.pem -out certs/cert.pem -days 365 -subj '/CN=localhost'
#
# TLS_ENABLED=false
# TLS_CERT_FILE=/certs/cert.pem
# TLS_KEY_FILE=/certs/key.pem

# ── URL fetching ───────────────────────────────────────────────────────────────
HTTP_TIMEOUT_SECONDS=10
HTTP_USER_AGENT=mcpvectordb/1.0

# ── Logging ────────────────────────────────────────────────────────────────────
LOG_LEVEL=INFO                     # DEBUG | INFO | WARNING | ERROR
# In stdio mode ALL output must go to stderr or a file — never stdout.
# LOG_FILE=~/.mcpvectordb/server.log  # uncomment to log to file instead of stderr

# ── OAuth — Google Resource Server mode ────────────────────────────────────────
# Set OAUTH_ENABLED=true to require Google sign-in for streamable-http transport.
# The server acts as a pure Resource Server — it validates tokens issued by Google
# and never issues tokens itself. No client_secret is stored here.
#
# Setup: Google Cloud Console → APIs & Services → Credentials
#   → Create Credentials → OAuth 2.0 Client ID
#   Application type: Web application
#   Authorised redirect URIs: (set per Claude Desktop's OAuth callback)
#   Copy the client_id (ends in .apps.googleusercontent.com) → OAUTH_CLIENT_ID
#
# OAUTH_ENABLED=false
# OAUTH_CLIENT_ID=                      # your-client-id.apps.googleusercontent.com
# OAUTH_RESOURCE_URL=                   # https://mcp.example.com  (public URL of this server)
# OAUTH_ALLOWED_EMAILS=                 # user@gmail.com,other@gmail.com  (empty = any Google account)

# ── Windows 11 native (no Docker) ─────────────────────────────────────────────
# The server auto-detects Windows and defaults to AppData\Local\mcpvectordb.
# Uncomment and adjust only if you want to override those defaults.
#
# LANCEDB_URI=C:\Users\<you>\AppData\Local\mcpvectordb\lancedb
# LOG_FILE=C:\Users\<you>\AppData\Local\mcpvectordb\server.log
# FASTEMBED_CACHE_PATH=C:\Users\<you>\AppData\Local\mcpvectordb\models

# ── Docker / Container mode ────────────────────────────────────────────────────
# When running in a container, override the local-dev defaults above with the
# container-appropriate values below. The Dockerfile sets these as ENV defaults
# so you only need to uncomment here if you want to override them in .env.
#
# Transport — bind on all interfaces so Docker's port mapping works:
# MCP_TRANSPORT=streamable-http
# MCP_HOST=0.0.0.0
# MCP_PORT=8000
#
# LanceDB — use the volume mount path, not a home-directory tilde path:
# LANCEDB_URI=/data/lancedb
#
# fastembed ONNX model — baked into the image at /opt/models at build time.
# FASTEMBED_CACHE_PATH is set automatically; no override needed here.
#
# Source documents — host directory bind-mounted read-only at /data/docs.
# Set this to the absolute path on your host machine.
# docker-compose.yml reads DOCS_DIR to configure the bind mount:
# DOCS_DIR=/Users/you/Documents/my-library
